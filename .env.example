# ======================================
# Environment Configuration
# ======================================
# Template for local development configuration.
#
# Conventions in this repository:
# - Copy this file to `.env` for your local setup.
# - `.env` is ignored by git (local-only).
# - If you need per-machine overrides, use `.env.local` (also local-only).
#
# `just up` loads `.env` and runs tools/change_me_local_secret.py to replace
# the placeholder secret in both `.env` and `.keycloak.json`.
#

# ======================================
# Application Identity
# ======================================
# Human-readable application description
APP_DESCRIPTION="Go template showcasing Domain-Driven Design and Hexagonal Architecture"

# Display name used in UI and logs
APP_NAME="Template"

# Short name used for Docker image tags, container names, etc.
# Format: lowercase alphanumeric only (no spaces, special chars)
APP_SHORTNAME="template"

# ======================================
# HTTP Server
# ======================================
# Port the application listens on (default: 8080)
# Note: docker-compose.yml maps 8080 on container to 8080 on localhost
PORT=8080

# Redirect URL after successful authentication
# Must match OIDC provider's allowed redirect URI
REDIRECT_URL="http://localhost:8080/ui"

# ======================================
# Kafka - Event Streaming
# ======================================
# Comma-separated list of Kafka broker addresses
# Format: host1:port,host2:port
#
# Default is the Docker Compose service name, because the app typically runs in a
# container when using `just up`.
# If you run the server locally (`just serve`), use `localhost:9092` instead.
KAFKA_BROKERS="localhost:9092"

# Consumer group ID for event subscribers
# Kafka uses this to manage partition offsets
KAFKA_CONSUMER_GROUP_ID="test-group"

# ======================================
# OIDC / OpenID Connect - Authentication
# ======================================
# Note: Keycloak provides the OIDC provider in docker-compose.yml
# Admin console: http://127.0.0.1:8180/admin (admin:admin)

# Client ID registered in Keycloak realm
# Must match keycloak/local-realm.json configuration
OIDC_CLIENT_ID="template"

# Client secret for OIDC flow
# Development workflow:
# - Keep the placeholder value `CHANGE_ME_LOCAL_SECRET`.
# - `just up` runs tools/change_me_local_secret.py to generate a per-machine secret.
# - Do NOT commit real secrets to version control.
OIDC_CLIENT_SECRET="CHANGE_ME_LOCAL_SECRET"

# Keycloak realm issuer URL
# Format: http(s)://host:port/realms/{realm-name}
#
# IMPORTANT - One issuer URL for browser + app:
# OIDC issuer URLs are strict: the URL configured in the app MUST match the issuer
# returned by Keycloak's discovery document.
#
# This template standardizes on a single issuer URL that works for both:
# - Browsers on the host:              http://localhost:8180/...
# - App running inside Docker:         http://localhost:8180/...
#
# This is achieved via docker-compose.yml using:
#   app.extra_hosts: ["localhost:host-gateway"]
# which makes `localhost` inside the container resolve to the host gateway.
OIDC_ISSUER="http://localhost:8180/realms/local"

# Callback URL after Keycloak authentication
# Must match OIDC_CLIENT_ID's redirect URI in Keycloak
OIDC_REDIRECT_URL="http://localhost:8080/auth/callback"

# ======================================
# HTTP Server Timeouts
# ======================================
# Timeouts prevent hanging connections and resource exhaustion
# All values use Go duration format: "5s", "100ms", "1m", etc.

# Maximum time to wait for idle client connections to close
SERVER_IDLE_TIMEOUT="5s"

# Maximum time to read request headers (prevents Slowloris attacks)
SERVER_READ_HEADER_TIMEOUT="5s"

# Maximum time to read entire request body
SERVER_READ_TIMEOUT="5s"

# Maximum time to write response back to client
SERVER_WRITE_TIMEOUT="5s"

# ======================================
# Resilience & Stability (cloud-native-utils)
# ======================================
# Thresholds and parameters for fault tolerance and graceful degradation

# Circuit breaker: number of failures before opening circuit
# Open circuit = fast-fail without attempting request
SERVICE_BREAKER_THRESHOLD="5"

# Rate limiting: maximum events per second to process
# Excess events are debounced (dropped or batched)
SERVICE_DEBOUNCE_PER_SEC="10"

# Retry mechanism: delay between retry attempts
# Used for transient failures (network timeouts, 5xx errors)
SERVICE_RETRY_DELAY="5s"

# Retry mechanism: maximum number of attempts
# Total time: SERVICE_RETRY_MAX * SERVICE_RETRY_DELAY (up to 15 seconds here)
SERVICE_RETRY_MAX="3"

# Service call timeout: max time for external calls
# Prevents indefinite hangs on slow dependencies
SERVICE_TIMEOUT="5s"
